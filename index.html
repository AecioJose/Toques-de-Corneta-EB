<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toques de Corneta</title>
    <link rel="icon" href="sources/page/corneta.ico" type="image/x-icon">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Spline+Sans+Mono&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&display=swap" rel="stylesheet">
   <link rel="stylesheet" href="./sources/page/css/style.css">
</head>
<body>

    <header>
        <div class="monitorPFL">

        </div>

        
        <span style="display: flex; flex-direction: row; align-items: center; justify-content: center;" >Toques De Corneta <img style="margin-left: 15px; width: 50px;" src="sources/page/corneta.ico" alt="Minha Figura"> </span>
        

        <div><!--Menuzinho de playlist com ultima opção de adicionar nova playlist-->

        </div>
    </header>

    <main>
        <div class="sombra"></div>

        <div id="button-container">
            <!-- Botões de toques serão gerados aqui -->
        </div>

        

        <div class="actions">
            <button id="add-tones-btn">Adicionar Toques <span style="font-size: 3vw; margin-left: 0.5vw;">+</span></button>
            <button id="edit-btn"><img id="edit-img" src="sources/page/pencil.png" alt="Imagem de lapis representando que ao clicar aqui você edita os cards"></button>
        </div>
        
    </main>

    <script>
        // Selecionando elementos do DOM
        const buttonContainer = document.getElementById('button-container');
        const addTonesBtn = document.getElementById('add-tones-btn');
        const editBtnNchangeOrder = document.getElementById('edit-btn');
        const changeOrderImg = document.getElementById('edit-img');

        // Estados da aplicação
        let isAddingTones = false;
        let isChangingOrder = false;
        let selectedTones = JSON.parse(localStorage.getItem('selectedTones')) || [];
        let toneOrder = JSON.parse(localStorage.getItem('toneOrder')) || selectedTones.slice(); // Inicialmente, a ordem segue a seleção

        let currentAudio = null;
        let audioGlobal = new Audio();

        audioGlobal.addEventListener('canplay', (event) => {
            event.target.play()
        })



        // Dados dos toques (imagens e áudios) - Edite os caminhos conforme necessário
        const tones = [
            { id: 1, name: "Sentido", image: "sources/imgs/sentido.png", audio: "sources/audio/sentido.mp3" },
            { id: 2, name: "Descansar", image: "sources/imgs/descansar.png", audio: "sources/audio/Descansar.mp3" },
            { id: 3, name: "Direita Volver", image: "sources/imgs/direitavolver.png", audio: "sources/audio/direita_volver.mp3" },
            { id: 4, name: "Esquerda Volver", image: "sources/imgs/esquerdavolver.png", audio: "sources/audio/esquerda_volver.mp3" },

            { id: 5, name: "Meia Volta volver", image: "sources/imgs/meiavoltavolver.png", audio: "sources/audio/Meia_Volta_volver.mp3" },

            { id: 6, name: "Cobrir", image: "sources/imgs/cobrir.png", audio: "sources/audio/cobrir.mp3" },
            { id: 7, name: "Firme", image: "sources/imgs/firme.png", audio: "sources/audio/firme.mp3" },
            { id: 8, name: "Ultima Forma", image: "sources/imgs/ultimaForma.png", audio: "sources/audio/ultima_forma.mp3" },
            { id: 9, name: "À Vontade", image: "sources/imgs/avontade.png", audio: "sources/audio/a_vontade.mp3" },
            { id: 10, name: "Cessar à Vontade", image: "sources/imgs/cessaravontade.png", audio: "sources/audio/cessarAvontade.mp3" },

            { id: 11, name: "Ordinario Marche", image: "sources/imgs/ordinarioMarche.png", audio: "sources/audio/ordinarioMarche.mp3" },
            { id: 12, name: "Marcar Passo", image: "sources/imgs/marcapasso.png", audio: "sources/audio/marcar_passo.mp3" },
            { id: 13, name: "Alto", image: "sources/imgs/alto.png", audio: "sources/audio/alto.mp3" },
            
            { id: 14, name: "Ombro Arma", image: "sources/imgs/ombroarma.png", audio: "sources/audio/ombro_arma.mp3" },
            { id: 15, name: "Cruzar Arma", image: "sources/imgs/cruzararma.png", audio: "sources/audio/cruzar_arma.mp3" },
            { id: 16, name: "Apresentar Arma", image: "sources/imgs/apresentarArma.png", audio: "sources/audio/apresentar_arma.mp3" },
            { id: 17, name: "Amar Baioneta", image: "sources/imgs/armarbaioneta.png", audio: "sources/audio/Armar_Baioneta.mp3" },
            { id: 18, name: "Desarmar Baioneta", image: "sources/imgs/desarmarbaioneta.png", audio: "sources/audio/Desarmar_Baioneta.mp3" },
            { id: 19, name: "Descansar Arma", image: "sources/imgs/descansararma.png", audio: "sources/audio/descansar_arma.mp3" },
            { id: 20, name: "Arma Suspensa!!", image: "sources/imgs/armasuspensa.png", audio: "sources/audio/audio24.mp3" },/*audio*/
            { id: 21, name: "Arma Na Mão!!", image: "sources/imgs/armanamao.png", audio: "sources/audio/audio25.mp3" },/*audio*/
            { id: 22, name: "Ao Solo Arma!!", image: "sources/imgs/aosoloarma.png", audio: "sources/audio/audio24.mp3" },/*audio*/
            
            { id: 23, name: "Alvorada", image: "sources/imgs/alvorada.png", audio: "sources/audio/alvorada.mp3" },
            
            
            { id: 24, name: "Hino do Brasil", image: "sources/imgs/brasil.png", audio: "sources/audio/HinoNacionalBrasileiro.mp3" },
            { id: 25, name: "Canção Do Exército", image: "sources/imgs/cancaoexercito.jpg", audio: "sources/audio/CançãodoExército.mp3" },
            { id: 26, name: "Hino a caxias", image: "sources/imgs/caxias.jpg", audio: "sources/audio/hinoacaxias.mp3" },
            { id: 27, name: "Incorporação da Bandeira", image: "sources/imgs/incorpbandeira.png", audio: "sources/audio/IncorporaçãodaBandeira.mp3" },

            
            { id: 28, name: "Exórdio Juramento", image: "sources/imgs/notamusical.png", audio: "sources/audio/ExórdioJuramento.mp4" },
            { id: 29, name: "Quatro Dias de Viagem", image: "sources/imgs/notamusical.png", audio: "sources/audio/QuatroDiasdeViagem.mp3" },
            { id: 30, name: "Velhos Camaradas", image: "sources/imgs/notamusical.png", audio: "sources/audio/Velhoscamaradas.mp3" },
            { id: 31, name: "Avante Camaradas com Bumbo", image: "sources/imgs/ordinarioMarcheDobrado.png", audio: "sources/audio/AvanteCamaradasComBumbo.mp3" },
            { id: 32, name: "Batista de Melo", image: "sources/imgs/ordinarioMarcheDobrado.png", audio: "sources/audio/batistademelo.mp3" },
            { id: 33, name: "Hino Nacional Instrumental", image: "sources/imgs/brasil.png", audio: "sources/audio/HinoNacional-Instrumental.mp3" },
            { id: 34, name: "Continencia Bandeira + Apresentar Arma", image: "sources/imgs/notamusical.png", audio: "sources/audio/Emcontinenciaabandeiracomapresentararma.mp3" },
            { id: 35, name: "Bandeira Avançar", image: "sources/imgs/notamusical.png", audio: "sources/audio/BandeiraAvancar.mp3" },
            
            { id: 36, name: "Toque 36", image: "sources/imgs/img.png", audio: "sources/audio/audio36.mp3" },
            { id: 37, name: "Toque 37", image: "sources/imgs/image.png", audio: "sources/audio/audio37.mp3" },
	        { id: 38, name: "Toque 38", image: "sources/imgs/image.png", audio: "sources/audio/audio38.mp3" },
            { id: 39, name: "Toque 39", image: "sources/imgs/image.png", audio: "sources/audio/audio39.mp3" },
            { id: 40, name: "Toque 40", image: "sources/imgs/image.png", audio: "sources/audio/audio40.mp3" }]
        

        // Função para salvar seleção e ordem no localStorage
        function saveToLocalStorage() {
            localStorage.setItem('selectedTones', JSON.stringify(selectedTones));
            localStorage.setItem('toneOrder', JSON.stringify(toneOrder));
        }

        // Função para renderizar os botões de toques
        function renderTones() {
            buttonContainer.innerHTML = '';

            // Determinar quais toques serão exibidos
            let tonesToDisplay = [];

            if (isAddingTones) {
                // Exibe todos os toques, com os não selecionados no final
                tonesToDisplay = tones.filter(tone => !selectedTones.includes(tone.id));
                tonesToDisplay = [...selectedTones.map(id => tones.find(t => t.id === id)), ...tonesToDisplay];
            } else {
                // Exibe apenas os toques na ordem definida
                tonesToDisplay = toneOrder.map(id => tones.find(tone => tone.id === id));
            }

            tonesToDisplay.forEach(tone => {
                const button = document.createElement('div');
                button.classList.add('tone-button');
                button.dataset.id = tone.id;

                // Adicionar classe 'selected' se o toque estiver selecionado
                if (selectedTones.includes(tone.id)) {
                    button.classList.add('selected');
                }

                button.innerHTML = `
                    <img src="${tone.image}" alt="${tone.name}">
                    <span>${tone.name}</span>
                `;

                // Eventos de clique
                if (isAddingTones) {
                    button.addEventListener('click', () => toggleToneSelection(tone.id));
                } else {
                    button.addEventListener('click', () => playTone(tone.audio));
                }

                // Eventos de drag and drop
                if (isChangingOrder) {
                    button.setAttribute('draggable', true);
                    button.addEventListener('dragstart', dragStart);
                    button.addEventListener('dragover', dragOver);
                    button.addEventListener('drop', drop);
                    button.addEventListener('dragend', dragEnd);
                }

                buttonContainer.appendChild(button);
            });
        }


        function playTone(audioPath) {

            if (!audioGlobal.paused) {
                console.log("Is Playing")
                return
            } else if (audioGlobal.src.substring(audioGlobal.src.lastIndexOf('/') + 1) === audioPath.substring(audioPath.lastIndexOf('/') + 1) && audioGlobal.paused) {
                console.log(`Play! src is ${audioPath}`)
                audioGlobal.play()
                return
            }
            
            audioGlobal.src = audioPath
        }

        
        // Pausar o áudio ao pressionar a barra de espaço
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                event.preventDefault();
                audioGlobal.pause();
            }
        });


        // Função para alternar a seleção de um toque
        function toggleToneSelection(toneId) {
            if (selectedTones.includes(toneId)) {
                selectedTones = selectedTones.filter(id => id !== toneId);
                toneOrder = toneOrder.filter(id => id !== toneId);
            } else {
                selectedTones.push(toneId);
                toneOrder.splice(selectedTones.length - 1, 0, toneId); // Move para o final dos selecionados
            }

            renderTones();
            saveToLocalStorage();
        }

        // Variáveis para drag and drop
        let draggedToneId = null;

        function dragStart(e) {
            draggedToneId = Number(e.currentTarget.dataset.id);
            e.currentTarget.classList.add('dragging');
        }

        function dragOver(e) {
            e.preventDefault();
            const target = e.currentTarget;
            const targetToneId = Number(target.dataset.id);

            if (draggedToneId === targetToneId) return;

            const draggedIndex = toneOrder.indexOf(draggedToneId);
            const targetIndex = toneOrder.indexOf(targetToneId);

            toneOrder.splice(draggedIndex, 1);
            toneOrder.splice(targetIndex, 0, draggedToneId);

            renderTones();
        }

        function drop(e) {
            e.currentTarget.classList.remove('dragging');
            saveToLocalStorage();
        }

        function dragEnd(e) {
            e.currentTarget.classList.remove('dragging');
            saveToLocalStorage();
        }

        // Botoes de editar/mudar posição e adicionar toques
        addTonesBtn.addEventListener('click', () => {
            isAddingTones = !isAddingTones;
            if (isAddingTones) {
                isChangingOrder = false;
                editBtnNchangeOrder.style.display = 'none';
                addTonesBtn.classList.add('active');
                addTonesBtn.innerHTML = '<img style="width: 65%; height: auto;" src="sources/page/white-check.png">';
            } else {
                isChangingOrder = true;
                addTonesBtn.classList.remove('active');
                addTonesBtn.innerHTML = 'Adicionar Toques <span style="font-size: 3vw; margin-left: 0.5vw;">+</span>';
                editBtnNchangeOrder.style.display = 'inline-block';
            }
            renderTones();
        });

        editBtnNchangeOrder.addEventListener('click', () => {
            isChangingOrder = !isChangingOrder;
            if (isChangingOrder) {
                isAddingTones = false;
                addTonesBtn.style.display = 'none';
                editBtnNchangeOrder.classList.add('active');
                changeOrderImg.src = "sources/page/white-check.png";
                addTonesBtn.style.display = 'flex';
            } else {
                editBtnNchangeOrder.classList.remove('active');
                changeOrderImg.src = "sources/page/pencil.png";
                addTonesBtn.style.display = 'none';
            }
            renderTones();
        });

        // Renderizar toques na inicialização
        renderTones();
    </script>

</body>
</html>
