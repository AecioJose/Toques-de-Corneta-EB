<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toques de Corneta</title>
    <link rel="icon" href="Sources\corneta.ico" type="image/x-icon">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #092b00;
        }

        #button-container {
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
            flex-wrap: wrap; /* Permite que as divs "quebrem" para a próxima linha */

        }

        .tone-button {
            width: 14vw;
            height: 12vw;
            margin: 10px 20px;
            padding: 10px;
            background-color: #cfcece;
            border: 2px solid #ccc;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
            position: relative;
            user-select: none;

            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
        }

        .tone-button.selected {
            background-color: #ffffff;
            border-color: #0f5132;
        }

        .tone-button.dragging {
            opacity: 0.5;
        }

        .tone-button img {
            height: 9vw;
            width: auto;
            display: block;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        .actions button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .actions button#add-tones-btn {
            background-color: #0d6efd;
            color: #ffffff;
        }

        .actions button#add-tones-btn.active {
            background-color: #0b5ed7;
        }

        .actions button#change-order-btn {
            background-color: #16973d;
            color: #ffffff;
        }

        .actions button#change-order-btn.active {
            background-color: #157347;
        }
    </style>
</head>
<body>

    <div id="button-container">
        <!-- Botões de toques serão gerados aqui -->
    </div>

    <div class="actions">
        <button id="add-tones-btn">Adicionar Toques</button>
        <button id="change-order-btn">Mudar Ordem</button>
    </div>

    <script>
        // Selecionando elementos do DOM
        const buttonContainer = document.getElementById('button-container');
        const addTonesBtn = document.getElementById('add-tones-btn');
        const changeOrderBtn = document.getElementById('change-order-btn');

        // Estados da aplicação
        let isAddingTones = false;
        let isChangingOrder = false;
        let selectedTones = JSON.parse(localStorage.getItem('selectedTones')) || [];
        let toneOrder = JSON.parse(localStorage.getItem('toneOrder')) || selectedTones.slice(); // Inicialmente, a ordem segue a seleção

        let currentAudio = null;
        let isAudioPlaying = false;

        // Dados dos toques (imagens e áudios) - Edite os caminhos conforme necessário
        const tones = [
            { id: 1, name: "Sentido", image: "Sources/sentido.png", audio: "Sources/sentido.mp3" },
            { id: 2, name: "Descansar", image: "Sources/descansar.png", audio: "Sources/Descansar.mp3" },
            { id: 3, name: "Direita Volver", image: "Sources/direitavolver.png", audio: "Sources/direita_volver.mp3" },
            { id: 4, name: "Esquerda Volver", image: "Sources/esquerdavolver.png", audio: "Sources/esquerda_volver.mp3" },

            { id: 5, name: "Meia Volta volver", image: "Sources/meiavoltavolver.png", audio: "Sources/Meia_Volta_volver.mp3" },

            { id: 6, name: "Cobrir", image: "Sources/cobrir.png", audio: "Sources/cobrir.mp3" },
            { id: 7, name: "Firme", image: "Sources/firme.png", audio: "Sources/firme.mp3" },
            { id: 8, name: "Ultima Forma", image: "Sources/ultimaForma.png", audio: "Sources/ultima_forma.mp3" },
            { id: 9, name: "À Vontade", image: "Sources/avontade.png", audio: "Sources/a_vontade.mp3" },
            { id: 10, name: "Cessar à Vontade!!", image: "Sources/cessaravontade.png", audio: "Sources/audio15.mp3" },/*audio*/

            { id: 11, name: "Ordinario Marche", image: "Sources/ordinarioMarche.png", audio: "Sources/audio6.mp3" },
            { id: 12, name: "Ordinario Marche com dobrado", image: "Sources/ordinarioMarcheDobrado.png", audio: "Sources/ordinariomarchecomdobrado.mp3" },
            { id: 13, name: "Batista de Melo", image: "Sources/ordinarioMarcheDobrado.png", audio: "Sources/ordinariomarchecomdobrado2.mp3" },
            { id: 14, name: "Marcar Passo", image: "Sources/marcapasso.png", audio: "Sources/marcar_passo.mp3" },
            { id: 15, name: "Alto", image: "Sources/alto.png", audio: "Sources/alto.mp3" },
            
            { id: 16, name: "Ombro Arma", image: "Sources/ombroarma.png", audio: "Sources/ombro_arma.mp3" },
            { id: 17, name: "Cruzar Arma", image: "Sources/cruzararma.png", audio: "Sources/cruzar_arma.mp3" },
            { id: 18, name: "Apresentar Arma", image: "Sources/apresentarArma.png", audio: "Sources/apresentar_arma.mp3" },
            { id: 19, name: "Amar Baioneta", image: "Sources/armarbaioneta.png", audio: "Sources/Armar_Baioneta.mp3" },
            { id: 20, name: "Desarmar Baioneta", image: "Sources/desarmarbaioneta.png", audio: "Sources/Desarmar_Baioneta.mp3" },
            { id: 21, name: "Descansar Arma!!", image: "Sources/descansararma.png", audio: "Sources/audio21.mp3" },/*audio*/
            { id: 22, name: "Arma Suspensa!!", image: "Sources/armasuspensa.png", audio: "Sources/audio24.mp3" },/*audio*/
            { id: 23, name: "Arma Na Mão!!", image: "Sources/armanamao.png", audio: "Sources/audio25.mp3" },/*audio*/
            { id: 24, name: "Ao Solo Arma!!", image: "Sources/aosoloarma.png", audio: "Sources/audio24.mp3" },/*audio*/
            
            { id: 25, name: "Alvorada", image: "Sources/alvorada.png", audio: "Sources/alvorada.mp3" },
            
            
            { id: 26, name: "Hino do Brasil", image: "Sources/brasil.jfif", audio: "Sources/HinoNacionalBrasileiro.mp3" },
            { id: 27, name: "Canção Do Exército", image: "Sources/cancaoexercito.jpg", audio: "Sources/CançãodoExército.mp3" },
            { id: 28, name: "Hino a caxias", image: "Sources/caxias.jpg", audio: "Sources/hinoacaxias.mpeg" },
            { id: 29, name: "Incorporação da Bandeira", image: "Sources/incorpbandeira.png", audio: "Sources/IncorporaçãodaBandeira.mp3" },

            
            { id: 30, name: "Exórdio Juramento", image: "Sources/notamusical.png", audio: "Sources/ExórdioJuramento.mp4" },
            { id: 31, name: "Quatro Dias de Viagem", image: "Sources/notamusical.png", audio: "Sources/QuatroDiasdeViagem.mp3" },
            { id: 32, name: "Velhos Camaradas", image: "Sources/notamusical.png", audio: "Sources/Velhoscamaradas.mp3" },
            { id: 33, name: "Avante Camaradas com Bumbo", image: "Sources/ordinarioMarcheDobrado.png", audio: "Sources/AvanteCamaradascomBumbo.mp3" },
            { id: 34, name: "Hino Nacional Instrumental", image: "Sources/brasil.jfif", audio: "Sources/HinoNacional-Instrumental.mp3" },
            { id: 35, name: "Continencia Bandeira + Apresentar Arma", image: "Sources/notamusical.png", audio: "Sources/Emcontinenciaabandeiracomapresentararma.mp3" },
            { id: 36, name: "Bandeira Avancar", image: "Sources/notamusical.png", audio: "Sources/BandeiraAvancar.mp3" },
            { id: 37, name: "Toque 37", image: "Sources/image36.png", audio: "Sources/audio36.mp3" },
	    { id: 38, name: "Toque 38", image: "Sources/image31.png", audio: "Sources/audio31.mp3" },
            { id: 39, name: "Toque 39", image: "Sources/image37.png", audio: "Sources/audio37.mp3" },
            { id: 40, name: "Toque 40", image: "Sources/image38.png", audio: "Sources/audio38.mp3" }
        ];

        // Função para salvar seleção e ordem no localStorage
        function saveToLocalStorage() {
            localStorage.setItem('selectedTones', JSON.stringify(selectedTones));
            localStorage.setItem('toneOrder', JSON.stringify(toneOrder));
        }

        // Função para renderizar os botões de toques
        function renderTones() {
            buttonContainer.innerHTML = '';

            // Determinar quais toques serão exibidos
            let tonesToDisplay = [];

            if (isAddingTones) {
                // Exibe todos os toques, com os não selecionados no final
                tonesToDisplay = tones.filter(tone => !selectedTones.includes(tone.id));
                tonesToDisplay = [...selectedTones.map(id => tones.find(t => t.id === id)), ...tonesToDisplay];
            } else {
                // Exibe apenas os toques na ordem definida
                tonesToDisplay = toneOrder.map(id => tones.find(tone => tone.id === id));
            }

            tonesToDisplay.forEach(tone => {
                const button = document.createElement('div');
                button.classList.add('tone-button');
                button.dataset.id = tone.id;

                // Adicionar classe 'selected' se o toque estiver selecionado
                if (selectedTones.includes(tone.id)) {
                    button.classList.add('selected');
                }

                button.innerHTML = `
                    <img src="${tone.image}" alt="${tone.name}">
                    <span>${tone.name}</span>
                `;

                // Eventos de clique
                if (isAddingTones) {
                    button.addEventListener('click', () => toggleToneSelection(tone.id));
                } else {
                    button.addEventListener('click', () => playTone(tone));
                }

                // Eventos de drag and drop
                if (isChangingOrder) {
                    button.setAttribute('draggable', true);
                    button.addEventListener('dragstart', dragStart);
                    button.addEventListener('dragover', dragOver);
                    button.addEventListener('drop', drop);
                    button.addEventListener('dragend', dragEnd);
                }

                buttonContainer.appendChild(button);
            });
        }

        // Função para tocar o áudio do toque
        function playTone(tone) {
            if (isAudioPlaying) return; // Bloquear se um áudio já estiver tocando

            currentAudio = new Audio(tone.audio);
            isAudioPlaying = true;
            currentAudio.play();

            currentAudio.addEventListener('ended', () => {
                isAudioPlaying = false;
                currentAudio = null;
            });
        }

        // Pausar o áudio ao pressionar a barra de espaço
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && currentAudio && isAudioPlaying) {
                event.preventDefault();
                currentAudio.pause();
                isAudioPlaying = false;
                currentAudio = null;
            }
        });

        // Função para alternar a seleção de um toque
        function toggleToneSelection(toneId) {
            if (selectedTones.includes(toneId)) {
                selectedTones = selectedTones.filter(id => id !== toneId);
                toneOrder = toneOrder.filter(id => id !== toneId);
            } else {
                selectedTones.push(toneId);
                toneOrder.splice(selectedTones.length - 1, 0, toneId); // Move para o final dos selecionados
            }

            renderTones();
            saveToLocalStorage();
        }

        // Variáveis para drag and drop
        let draggedToneId = null;

        function dragStart(e) {
            draggedToneId = Number(e.currentTarget.dataset.id);
            e.currentTarget.classList.add('dragging');
        }

        function dragOver(e) {
            e.preventDefault();
            const target = e.currentTarget;
            const targetToneId = Number(target.dataset.id);

            if (draggedToneId === targetToneId) return;

            const draggedIndex = toneOrder.indexOf(draggedToneId);
            const targetIndex = toneOrder.indexOf(targetToneId);

            toneOrder.splice(draggedIndex, 1);
            toneOrder.splice(targetIndex, 0, draggedToneId);

            renderTones();
        }

        function drop(e) {
            e.currentTarget.classList.remove('dragging');
            saveToLocalStorage();
        }

        function dragEnd(e) {
            e.currentTarget.classList.remove('dragging');
            saveToLocalStorage();
        }

        // Eventos dos botões de ação
        addTonesBtn.addEventListener('click', () => {
            isAddingTones = !isAddingTones;
            if (isAddingTones) {
                isChangingOrder = false;
                changeOrderBtn.style.display = 'none';
                addTonesBtn.classList.add('active');
                addTonesBtn.textContent = 'Salvar';
            } else {
                addTonesBtn.classList.remove('active');
                addTonesBtn.textContent = 'Adicionar Toques';
                changeOrderBtn.style.display = 'inline-block';
            }
            renderTones();
        });

        changeOrderBtn.addEventListener('click', () => {
            isChangingOrder = !isChangingOrder;
            if (isChangingOrder) {
                if (selectedTones.length === 0) {
                    alert('Nenhum toque selecionado para mudar a ordem.');
                    isChangingOrder = false;
                    return;
                }
                isAddingTones = false;
                addTonesBtn.style.display = 'none';
                changeOrderBtn.classList.add('active');
                changeOrderBtn.textContent = 'Salvar';
            } else {
                changeOrderBtn.classList.remove('active');
                changeOrderBtn.textContent = 'Mudar Ordem';
                addTonesBtn.style.display = 'inline-block';
            }
            renderTones();
        });

        // Renderizar toques na inicialização
        renderTones();
    </script>

</body>
</html>
